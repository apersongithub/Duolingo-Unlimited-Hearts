<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>duolingo app.js patcher</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
  textarea { width: 100%; height: 200px; font-family: monospace; margin-bottom: 10px; }
  pre { background: #222; color: #0f0; padding: 10px; white-space: pre-wrap; }
</style>
</head>
<body>
<h1>duolingo app.js patcher</h1>
<input type="file" id="fileInput" accept=".js">
<button id="transformBtn">Transform</button>
<a id="downloadLink" style="display:none;">Download Modified File</a>
<br><br>
<textarea id="inputArea" placeholder="// Paste or open a JS file"></textarea>
<pre id="outputArea">(no output yet)</pre>

<script>
function transformCode(code) {
  // 1) Replace only => "free" or => 'free' with => "schools"
  code = code.replace(/=>\s*(['"])free\1/g, '=> "schools"');

  // 2) Append "free" to ["schools","beta course","revenue paused"]
  code = code.replace(
    /\[\s*(['"])schools\1\s*,\s*(['"])beta course\2\s*,\s*(['"])revenue paused\3\s*\]/g,
    (match, q1, q2, q3) => {
      const quote = q1 || '"';
      return `[${quote}schools${quote}, ${quote}beta course${quote}, ${quote}revenue paused${quote}, ${quote}free${quote}]`;
    }
  );

  return code;
}

document.getElementById('fileInput').addEventListener('change', e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    document.getElementById('inputArea').value = ev.target.result;
  };
  reader.readAsText(file);
});

document.getElementById('transformBtn').addEventListener('click', () => {
  const original = document.getElementById('inputArea').value;
  const modified = transformCode(original);
  document.getElementById('outputArea').textContent = modified;

  const blob = new Blob([modified], { type: 'application/javascript' });
  const url = URL.createObjectURL(blob);
  const link = document.getElementById('downloadLink');
  link.href = url;
  link.download = 'modified.js';
  link.style.display = 'inline-block';
  link.textContent = 'Download modified.js';
});
</script>
</body>
</html>
