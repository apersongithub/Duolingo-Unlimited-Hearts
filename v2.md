# v2.0 Update - Difference Between Old and New app.js Patching Methods for the extension

## 1. How the app.js source is obtained
**Old method:**
- Blocked the site's original `app-*.js` request in the network.
- Always fetched my own **static pre-patched** `app.js` from GitHub.
- If the site updated `app.js`, my version could become outdated — causing **white screens** or broken functionality for everyone until I manually updated it.

**New method:**
- Lets the site's original `app-*.js` request happen first (or intercepts it).
- **Fetches the latest real file from the site itself** and patches it in real time.
- Always applies the patched changes to the **most recent version** of the script, avoiding breakage when the site updates.

---

## 2. Update handling
**Old method:**
- **Manual** — Had to wait for me to update the modified `app-*.js`.

**New method:**
- **Automatic** — when the site updates `app.js` (new hash in filename), the extension:
  1. Detects the new file.
  2. Fetches it.
  3. Applies your patch.
  4. Injects it immediately.
- No manual upkeep required for me.

---

## 3. Caching behavior
**Old method:**
- GitHub file fetched fresh unless cached locally.
- Always the same file until you changed it.
- Independent of the site's cache headers.

**New method:**
- Can use:
  - **Cache version** → Faster load, persists longer in Firefox because of caching headers.
  - **No-cache version** → Always freshly patched, prevents lingering patched file after uninstall.
- **Chrome:** Patched file disappears immediately when the extension is removed.
- **Firefox:** If using cache version, patched file can persist even after uninstall (due to persistent HTTP caching).

---

## 4. Risk of site breakage
**Old method:**
- Higher — static file could be incompatible if the site changes internal variables, order, or adds features.

**New method:**
- Lower — patch is applied to the **newest available file** from the site, preserving all their updates while injecting your modifications.

---

## 5. Performance & maintenance
**Old method:**
- Simple logic but **high manual maintenance**.
- No adaptation to updates.

**New method:**
- Slightly more complex logic, but **zero manual maintenance** once set up.
- Handles updates automatically and silently.

---

## Why Chrome and Firefox behave differently after uninstall

**Chrome:**
- Extensions modify network requests at runtime — they never actually store the patched file in the standard HTTP browser cache.
- When the extension is removed, the interception stops, so Chrome loads the unmodified site file instantly.

**Firefox:**
- When using a cache-based approach, the patched file **is** stored in the HTTP cache.
- Even after the extension is removed, Firefox may serve the cached patched file until:
  - The cache expires naturally (depends on the site's cache headers), or
  - You clear the duolingo.com site cache manually.
- This is why in Firefox, the "cached version" can linger, while Chrome always reverts immediately.

---

## Summary
**Before:** Before I had to replace the file each time with my own patched `app-*.js`.
**Now:** The extension patches it for you: taking the site's own latest file, patching it on the fly, and keeping everything in sync automatically.  
